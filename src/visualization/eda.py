import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime


df = pd.read_csv("../data/data_clean.csv")


def save_bar_chart(data, x_col, y_col, title, filename):
    grouped = data.groupby(x_col).size().reset_index(name="frecuencia")
    grouped = grouped.sort_values(by="frecuencia", ascending=False)
    fig = plt.figure(figsize=(10, 6))
    sns.barplot(x="frecuencia", y=x_col, data=grouped)
    plt.title(title)
    plt.xlabel("Frecuencia")
    plt.ylabel("Categorías")
    plt.savefig(filename, dpi=300, bbox_inches="tight")
    plt.close(fig)


save_bar_chart(
    df,
    "fuente_de_apoyo",
    "frecuencia",
    "Frecuencia de las Categorías de la Variable Fuente de Apoyo",
    "../visualization/fuente_de_apoyo.png",
)

save_bar_chart(
    df,
    "otras_actividades_actuales",
    "frecuencia",
    "Frecuencia de las Categorías de la Variable Otras Actividades Actuales",
    "../visualization/otras_actividades_actuales.png",
)

save_bar_chart(
    df,
    "tipo_involucramiento_anterior",
    "frecuencia",
    "Frecuencia de las Categorías de la Variable Tipo de Involucramiento Anterior",
    "../visualization/tipo_involucramiento_anterior.png",
)

save_bar_chart(
    df,
    "categoria",
    "frecuencia",
    "Frecuencia de las Categorías de la Variable Categoría Vulnerabilidad",
    "../visualization/categoria.png",
)


# Convertir la columna 'fecha_de_nacimiento' a objetos de fecha
df["fecha_de_nacimiento"] = pd.to_datetime(df["fecha_de_nacimiento"])

# Calcular la edad a partir de la fecha de nacimiento
today = datetime.today().date()
df["edad"] = today.year - df["fecha_de_nacimiento"].dt.year

# Filtrar los registros con edad menor que 15
df = df[df["edad"] >= 15]

# distribucion edad
fig = plt.figure(figsize=(15, 8))
plt.hist(df["edad"], bins=20, color="steelblue", edgecolor="black")
plt.title("Distribucion de la Edad de los Estudiantes")
plt.xlabel("Age")
plt.ylabel("Frequency")
plt.grid(True, linestyle="--", alpha=0.5)
plt.show()

fig.savefig("../visualization/edad.png", dpi=300, bbox_inches="tight")
